<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <link rel="icon" type="image/x-icon" href="/favicon.ico">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PG Plaisio - Artworks</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css">
    <link rel="stylesheet" href="styles/main.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-table@1.24.2/dist/bootstrap-table.min.css">
</head>

<body>

    <!-- Desktop Sidebar -->
    <div id="sidebar" class="sidebar d-none d-md-flex flex-column">
        <button class="btn btn-light mb-3 mx-2" id="toggleBtn">
            <i class="bi bi-list"></i>
        </button>
        <a href="#" class="nav-link"><i class="bi bi-house"></i><span> Home</span></a>
        <a href="#" class="nav-link"><i class="bi bi-gear"></i><span> Settings</span></a>
        <a href="#" class="nav-link"><i class="bi bi-box-arrow-right"></i><span> Logout</span></a>
    </div>

    <!-- Top Navbar (mobilde görünsün) -->
    <nav class="navbar navbar-light bg-light d-md-none">
        <div class="container-fluid">
            <button class="btn btn-outline-secondary" type="button" data-bs-toggle="offcanvas"
                data-bs-target="#mobileMenu">
                <i class="bi bi-list"></i>
            </button>
            <span class="navbar-brand mb-0 h1">My App</span>
        </div>
    </nav>

    <!-- Offcanvas Sidebar (mobil menü) -->
    <div class="offcanvas offcanvas-start" tabindex="-1" id="mobileMenu">
        <div class="offcanvas-header">
            <h5 class="offcanvas-title">Menu</h5>
            <button type="button" class="btn-close" data-bs-dismiss="offcanvas"></button>
        </div>
        <div class="offcanvas-body">
            <a href="#" class="nav-link mb-2"><i class="bi bi-house me-2"></i> Home</a>
            <a href="#" class="nav-link mb-2"><i class="bi bi-gear me-2"></i> Settings</a>
            <a href="#" class="nav-link"><i class="bi bi-box-arrow-right me-2"></i> Logout</a>
        </div>
    </div>

    <!-- Content -->
    <div id="content" class="content">
        <h3>Artworks</h3>

        <div id="toolbar">
            <form class="d-flex align-items-center gap-2">
                <label for="email" class="form-label mb-0">Stock Filter:</label>
                <select id="stockFilter" class="form-control form-select form-select-sm" style="width:200px;">
                    <option value="all">All</option>
                    <option value="in">In Stock</option>
                    <option value="out">Out of Stock</option>
                </select>
            </form>
        </div>

        <table data-search="true" id="table" data-show-refresh="true" data-show-columns="true"
            data-show-columns-toggle-all="true" data-pagination="true" data-page-size="50"
            data-page-list="[50, 75, 100, 250, all]" data-fixed-scroll="true" data-height="460"
            data-pagination-parts="pageList, pageSize" data-toolbar="#toolbar" data-loading-template="fa"
            data-sortable="true" data-sort-name="legend" data-sort-order="asc">
            <thead>
                <tr>
                    <th data-field="reference">Reference</th>
                    <th data-field="image_url" data-formatter="imageFormatter">Url</th>
                    <th data-field="legend">Legend</th>
                    <th data-field="quantity">qty</th>
                    <th data-field="hasQuantity" data-formatter="checkboxFormatter">Has Quantity</th>
                    <!-- hidden field for filtering -->
                    <th data-field="stockStatus" data-visible="false">Status</th>
                </tr>
            </thead>
        </table>

    </div>

    <!-- Modal -->
    <div class="modal fade" id="imageModal" tabindex="-1">
        <div class="modal-dialog modal-dialog-centered modal-lg">
            <div class="modal-content">
                <div class="modal-body text-center">
                    <img id="modalImage" src="" alt="Preview" class="img-fluid rounded">
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/jquery/dist/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap-table@1.24.2/dist/bootstrap-table.min.js"></script>
    <script src="scripts/app.js"></script>
    <script src="scripts/datahelper.js"></script>
    <script src="https://unpkg.com/papaparse@5.4.1/papaparse.min.js"></script>

    <script>

        function checkboxFormatter(value, row, index) {
            if (row.quantity > 0) {
                return `<span class="text-success"><i class="bi bi-check-square-fill"></i> In Stock</span>`;
            }
            return `<span class="text-danger"><i class="bi bi-x-square-fill"></i> Out</span>`;
        }

        function showImage(url) {
            document.getElementById('modalImage').src = url;
            const modal = new bootstrap.Modal(document.getElementById('imageModal'));
            modal.show();
        }

        function imageFormatter(value, row, index) {
            // Show a small clickable thumbnail
            return `<img src="${row.image_url}" 
               alt="thumb" 
               style="height:40px; cursor:pointer;" 
               onclick="showImage('${row.image_url}')">`;
        }

        function adjustTableHeight() {
            const windowHeight = window.innerHeight;
            const offsetTop = document.getElementById('table').getBoundingClientRect().top;
            const tableHeight = windowHeight - offsetTop - 20; // 20px margin
            $('#table').bootstrapTable('resetView', { height: tableHeight });
        }

        window.addEventListener('resize', adjustTableHeight);
        window.addEventListener('load', adjustTableHeight);

        $('#stockFilter').on('change', function () {
            const val = this.value;

            if (val === 'all') {
                $('#table').bootstrapTable('filterBy', {}); // reset filter
            } else {
                $('#table').bootstrapTable('filterBy', {
                    stockStatus: val
                });
            }
        });

        Papa.parse("data-files/artworks.csv", {
            download: true,
            header: true,  // ilk satırı kolon adı olarak al
            skipEmptyLines: true,
            complete: function (results) {
                if (results.errors.length) {
                    console.error("CSV parsing errors:", results.errors);
                }
                const data = results.data.map(r => ({
                    ...r,
                    stockStatus: r.quantity > 0 ? 'in' : 'out'
                }));
                $('#table').bootstrapTable({ data: data, formatRecordsPerPage: function (t) { return t; } });
                adjustTableHeight();
            }
        });
    </script>
</body>

</html>